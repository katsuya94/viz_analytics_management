
<h1>Engagement</h1>
<div class="row">
	<div class="col-xs-4">
		<h3>Bounce Rate - <span class="ajax text percent" metric="1"></span></h3>
		<div class="progress ajax percentile" metric="6">
			<div class="progress-bar progress-bar-success" role="progressbar" style="width: 0%; "></div>
			<div class="progress-bar progress-bar-warning" role="progressbar" style="width: 0%; "></div>
			<div class="progress-bar progress-bar-success" role="progressbar" style="width: 0%; "></div>
		</div>
	</div>
	<div class="col-xs-4">
		<h3>Pages Per Session - <span class="ajax text smallnum" metric="10">...</span></h3>
		<div class="progress ajax percentile" metric="15">
			<div class="progress-bar progress-bar-success" role="progressbar" style="width: 0%; "></div>
			<div class="progress-bar progress-bar-warning" role="progressbar" style="width: 0%; "></div>
			<div class="progress-bar progress-bar-success" role="progressbar" style="width: 0%; "></div>
		</div>
	</div>
	<div class="col-xs-4">
		<h3>Loyal Visitors - <span class="ajax text percent" metric="9">...</span></h3>
		<div class="progress ajax percentile" metric="8">
			<div class="progress-bar progress-bar-success" role="progressbar" style="width: 0%; "></div>
			<div class="progress-bar progress-bar-warning" role="progressbar" style="width: 0%; "></div>
			<div class="progress-bar progress-bar-success" role="progressbar" style="width: 0%; "></div>
		</div>
	</div>
</div>
<p><a href="#" class="btn btn-primary btn-lg">More</a></p>

<div class="row">
	<div class="col-xs-6">
		<h1>Acquisition</h1>
		<div class="row">
			<div class="col-xs-3"><h3>Search</h3></div>
			<div class="col-xs-9"><div class="progress ajax bar" metric="35"><div class="progress-bar progress-bar-success" role="progressbar" style="width: 0%; "></div></div></div>
		</div>
		<div class="row">
			<div class="col-xs-3"><h3>Social</h3></div>
			<div class="col-xs-9"><div class="progress ajax bar" metric="36"><div class="progress-bar progress-bar-success" role="progressbar" style="width: 0%; "></div></div></div>
		</div>
		<div class="row">
			<div class="col-xs-3"><h3>Direct</h3></div>
			<div class="col-xs-9"><div class="progress ajax bar" metric="31"><div class="progress-bar progress-bar-success" role="progressbar" style="width: 0%; "></div></div></div>
		</div>
		<div class="row">
			<div class="col-xs-3"><h3>Referral</h3></div>
			<div class="col-xs-9"><div class="progress ajax bar" metric="34"><div class="progress-bar progress-bar-success" role="progressbar" style="width: 0%; "></div></div></div>
		</div>
		<p><a href="#" class="btn btn-primary btn-lg">More</a></p>
	</div>
	<div class="col-xs-6">
		<h1>Platform</h1>
		<div class="progress" id="platform">
			<div class="progress-bar progress-bar-success ajax stackbar" metric="30" style="width: 0%" data-toggle="tooltip" data-placement="top" title="Desktop"><i class="fa fa-desktop"></i> </div>
			<div class="progress-bar progress-bar-warning ajax stackbar" metric="33" style="width: 0%" data-toggle="tooltip" data-placement="top" title="Mobile"><i class="fa fa-mobile"></i> </div>
			<div class="progress-bar progress-bar-danger ajax stackbar" metric="37" style="width: 0%" data-toggle="tooltip" data-placement="top" title="Tablet"><i class="fa fa-tablet"></i> </div>
		</div>	
		<p><a href="#" class="btn btn-primary btn-lg">More</a></p>
	</div>
</div>

<% content_for :head do %>

<style>
	.progress {
		height: 50px;
		line-height: 50px;
		vertical-align: middle;
		text-align: center;
		font-size: 18pt;
	}
	h3 {
		margin: 0;
		line-height: 50px;
		vertical-align: middle;
	}
	.progress div {
		line-height: 50px;
		vertical-align: middle;
		font-size: 18pt;
	}
	.progress-bar-success {
		background-color: #5CB8B8;
	}
	.progress-bar-danger {
		background-color: #5C5CB8;
	}
	.progress-bar-warning {
		background-color: #B85CB8;
	}
</style>

<script>
var possessive = ['th', 'st', 'nd', 'rd', 'th', 'th', 'th', 'th', 'th', 'th'];

$(function() {
	$('#platform').children().tooltip();
	$('.ajax').each(function(i, el) {
		$.getJSON(sprintf('/metrics/metric/%s', $(el).attr('metric')), function(data) {
			var value = $(el).hasClass('smallnum') ? data.value.toFixed(2) : Math.floor(data.value);
			value = $(el).hasClass('percentile') ? Math.min(99, value) : value;
			if($(el).hasClass('text')) {
				$(el).text(value + ($(el).hasClass('percent') ? '%' : ''));
			}
			if($(el).hasClass('bar')) {
				$(el).find('div').width(data.value + '%');
				if(data.value > 15)
					$(el).find('div').text(value + '%');
				else
					$(el).append(value + '%');
			}
			if($(el).hasClass('stackbar')) {
				$(el).width(data.value + '%')
				$(el).append(value + '%')
			}
			if($(el).hasClass('percentile')) {
				var left = Math.min(98, Math.max(0, data.value - 1));
				var right = 98 - left;
				$(el).children().eq(0).width(left + '%');
				$(el).children().eq(1).width('2%');
				$(el).children().eq(2).width(right + '%');
				if (left > right) {
					$(el).children().eq(0).html(value + possessive[value % 10] + '&nbsp;').css('text-align', 'right');
				} else {
					$(el).children().eq(2).html('&nbsp;' + value + possessive[value % 10]).css('text-align', 'left');
				}
			}
		}).fail(function() {
			if($(el).hasClass('text'))
				$(el).text('Not Found');
			if($(el).hasClass('bar'))
				$(el).text('Not Found');
		});
	});
	
});
</script>

<% end %>