
<h1>Engagement</h1>
<div class="row">
	<div class="col-xs-4">
		<h3>Bounce Rate</h3>
		<h4><span class="ajax" metric="1"><div class="progress"><div class="progress-bar progress-bar-success mypopover" role="progressbar" aria-valuemin="0" title="" data-content="content here" data-placement="bottom"  data-toggle="popover" data-original-title="personal title" style="width: 0%; "></div></div></span></h4>
		<h4><span class="ajax" metric="6"></span></h4>
	</div>
	<div class="col-xs-4">
		<h3>Pages Per Session</h3>
		<h4><span class="ajax" metric="10">Loading&hellip;</span></h4>
		<h4><span class="ajax" metric="15">Loading&hellip;</span></h4>
	</div>
	<div class="col-xs-4">
		<h3>Loyal Visitors</h3>
		<h4><span class="ajax" metric="8"><div class="progress"><div class="progress-bar progress-bar-success mypopover" role="progressbar" aria-valuemin="0" title="" data-content="content here" data-placement="bottom"  data-toggle="popover" data-original-title="personal title" style="width: 0%; "></div></div></span></h4>
		<h4><span class="ajax" metric="9"></span></h4>
	</div>
</div>
<p><a href="#" class="btn btn-primary btn-lg">More</a></p>

<div class="row">
	<div class="col-xs-6">
		<h1>Via&hellip;</h1>
		<div class="row">
			<div class="col-xs-3"><h3>Search</h3></div>
			<div class="col-xs-9"><h4><span class="ajax" metric="35"><div class="progress"><div class="progress-bar progress-bar-success mypopover" role="progressbar" aria-valuemin="0" title="" data-content="content here" data-placement="bottom"  data-toggle="popover" data-original-title="personal title" style="width: 0%; "></div></div></span></h4></div>
		</div>
		<div class="row">
			<div class="col-xs-3"><h3>Social</h3></div>
			<div class="col-xs-9"><h4><span class="ajax" metric="36"><div class="progress"><div class="progress-bar progress-bar-success mypopover" role="progressbar" aria-valuemin="0" title="" data-content="content here" data-placement="bottom"  data-toggle="popover" data-original-title="personal title" style="width: 0%; "></div></div></span></h4></div>
		</div>
		<div class="row">
			<div class="col-xs-3"><h3>Referral</h3></div>
			<div class="col-xs-9"><h4><span class="ajax" metric="34"><div class="progress"><div class="progress-bar progress-bar-success mypopover" role="progressbar" aria-valuemin="0" title="" data-content="content here" data-placement="bottom"  data-toggle="popover" data-original-title="personal title" style="width: 0%; "></div></div></span></h4></div>
		</div>
		<div class="row">
			<div class="col-xs-3"><h3>Direct</h3></div>
			<div class="col-xs-9"><h4><span class="ajax" metric="31"><div class="progress"><div class="progress-bar progress-bar-success mypopover" role="progressbar" aria-valuemin="0" title="" data-content="content here" data-placement="bottom"  data-toggle="popover" data-original-title="personal title" style="width: 0%; "></div></div></span></h4></div>
		</div>
		<p><a href="#" class="btn btn-primary btn-lg">More</a></p>
	</div>
	<div class="col-xs-6">
		<h1>Platform</h1>
		<div class="row">
			<div class="col-xs-4">

				<h3>On Desktop</h3>
				<h4><span class="ajax" metric="30" id="desktop"></span></h4>
			</div>
			<div class="col-xs-4">
				<h3>On Mobile</h3>
				<h4><span class="ajax" metric="33" id="mobile"></span></h4>
			</div>
			<div class="col-xs-4">
				<h3>On Tablet</h3>
				<h4><span class="ajax" metric="37" id="tablet"></span></h4>
			</div>
		</div>
		
		<div class="row" id="devicesRow">
			<div class="progress">
				<div class="progress-bar progress-bar-success" style="width: 0%">
					<span class="sr-only">35% Complete (success)</span>
				</div>
				<div class="progress-bar progress-bar-warning" style="width: 0%">
					<span class="sr-only">20% Complete (warning)</span>
				</div>
				<div class="progress-bar progress-bar-danger" style="width: 0%">
					<span class="sr-only">10% Complete (danger)</span>
				</div>
			</div>	
		</div>
		<p><a href="#" class="btn btn-primary btn-lg">More</a></p>
	</div>
</div>

<% content_for :head do %>

<script>
$(function() {
	var percentArray = ['31','34','36','35','8','1'];
	var percentileArray = ['6','9','15'];
	var device = ['30','33','37']
	var deviceDict = {};
	//$.inArray(value, array)>=0
	var value=0;
	var originalValue=0;
	var valueString = '';
	var percentValueString = '';
	var metricNumber='';
	var x = 0;
	$('.ajax').each(function(i, el) {
		$.getJSON(sprintf('/metrics/metric/%s', $(el).attr('metric')), function(data) {
			metricNumber =  $(el).attr('metric');
			originalValue = data.value.toFixed(0);
			value = data.value.toFixed(0);
			valueString = value.toString();
			percentValueString = valueString+'%'
			if($.inArray(metricNumber, percentArray)>=0)
			{
				valueString = valueString + '%';
				value = value/100;
			}
			else if($.inArray(metricNumber, percentileArray)>=0)
			{
				valueString = valueString + 'percentile';
				value = value/100;
			}
			else if($.inArray(metricNumber,device)>=0){
				console.log('logged metric number'+value.toString());
				deviceDict[metricNumber.toString()] = value;
				if(metricNumber=='37'){
					$('#devicesRow').text('');
					$('#devicesRow').append("<div class=\"progress\"> <div class=\"progress-bar progress-bar-success\" style=\"width: "+deviceDict['30']+"%\"> <span class=\"sr-only\">35% Complete (success)</span> </div> <div class=\"progress-bar progress-bar-warning\" style=\"width: "+deviceDict['33']+"%\"> <span class=\"sr-only\">20% Complete (warning)</span> </div> <div class=\"progress-bar progress-bar-danger\" style=\"width: "+deviceDict['37']+"%\"> <span class=\"sr-only\">10% Complete (danger)</span> </div> </div>");
				}
			}
			if($.inArray(metricNumber.toString, percentileArray)>=0 ||$.inArray(metricNumber.toString(), percentArray)>=0)
				$(el).find('div.progress div').width(percentValueString);
		}).fail(function() {
			$(el).text('Not Found');
		});
	});
	
	
	
// for devices, using stacked progress bar



	
});
$('.mypopover').popover({ trigger: "hover focus" });
</script>

<% end %>